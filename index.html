<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üöò Beta Games 3D World</title>
<style>
body { margin:0; overflow:hidden; background:skyblue; }
#ui { position:absolute; top:10px; left:10px; color:white; z-index:10;
     background:rgba(0,0,0,0.6); padding:10px; border-radius:10px; }
button { font-size:16px; margin:2px; cursor:pointer; }
#gameText { position:absolute; bottom:10px; left:10px; color:white; font-size:20px; z-index:10; }
</style>
</head>
<body>
<div id="ui">
<button onclick="backHub()">üèôÔ∏è Back to Hub</button>
<br>Controls: WASD / Arrow Keys
</div>
<div id="gameText">üèôÔ∏è Welcome to Beta Games!</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.157/build/three.min.js"></script>
<script>

// --- THREE.JS SETUP ---
let scene, camera, renderer;
let vehicle, vehicleGroup;
let speed=0, turn=0;
let clock = new THREE.Clock();
let currentStation = null;

// Hub and stations
const hubPos = {x:0, z:0};
const stations = {
  chess: {x:80, z:0, radius:7},
  rock: {x:-80, z:50, radius:7}
};

init();
animate();

// --- INIT ---
function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0,6,15);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff,0.6));
  const sun = new THREE.DirectionalLight(0xffffff,1);
  sun.position.set(10,20,10);
  scene.add(sun);

  // Ground
  const ground = new THREE.Mesh(
    new THREE.PlaneGeometry(500,500),
    new THREE.MeshStandardMaterial({color:0x444444})
  );
  ground.rotation.x = -Math.PI/2;
  scene.add(ground);

  createCity();
  createVehicle();
  createChessArea();
  createRockStage();

  document.addEventListener("keydown", e=>{
    switch(e.code){
      case "ArrowUp": case "KeyW": speed=0.5; break;
      case "ArrowDown": case "KeyS": speed=-0.3; break;
      case "ArrowLeft": case "KeyA": turn=0.05; break;
      case "ArrowRight": case "KeyD": turn=-0.05; break;
    }
  });
  document.addEventListener("keyup", ()=>{speed=0; turn=0;});

  window.addEventListener("resize", ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
}

// --- CITY ---
function createCity(){
  for(let i=0;i<20;i++){
    const h = 10 + Math.random()*30;
    const b = 5 + Math.random()*10;
    const box = new THREE.Mesh(
      new THREE.BoxGeometry(b,h,b),
      new THREE.MeshStandardMaterial({color:0x888888})
    );
    box.position.set((Math.random()-0.5)*200,h/2,(Math.random()-0.5)*200);
    scene.add(box);
    // add windows
    const winMat = new THREE.MeshStandardMaterial({color:0xffff00});
    for(let y=1;y<h;y+=3){
      for(let x=-b/2+1;x<b/2;x+=2){
        const w = new THREE.Mesh(new THREE.BoxGeometry(0.8,0.8,0.1), winMat);
        w.position.set(box.position.x + x, y, box.position.z + b/2 + 0.05);
        scene.add(w);
      }
    }
  }
}

// --- VEHICLE ---
function createVehicle(){
  vehicleGroup = new THREE.Group();

  // Body
  const bodyMat = new THREE.MeshStandardMaterial({color:0xff0000});
  const body = new THREE.Mesh(new THREE.BoxGeometry(4,1.5,2), bodyMat);
  body.position.y=1;
  vehicleGroup.add(body);

  // Windows (flat rectangles)
  const winMat = new THREE.MeshStandardMaterial({color:0x00ffff});
  const winFront = new THREE.Mesh(new THREE.BoxGeometry(1.5,0.8,0.05), winMat);
  winFront.position.set(0,1.5,1.05);
  vehicleGroup.add(winFront);

  const winBack = new THREE.Mesh(new THREE.BoxGeometry(1.5,0.8,0.05), winMat);
  winBack.position.set(0,1.5,-1.05);
  vehicleGroup.add(winBack);

  // Wheels
  const wheelMat = new THREE.MeshStandardMaterial({color:0x222222});
  const wheelGeom = new THREE.CylinderGeometry(0.5,0.5,0.5,16);
  const positions = [
    [1.5,0.5,1], [-1.5,0.5,1], [1.5,0.5,-1], [-1.5,0.5,-1]
  ];
  positions.forEach(p=>{
    const w = new THREE.Mesh(wheelGeom, wheelMat);
    w.rotation.z = Math.PI/2;
    w.position.set(...p);
    vehicleGroup.add(w);
  });

  vehicleGroup.position.set(hubPos.x,0,hubPos.z);
  scene.add(vehicleGroup);
}

// --- CHESS AREA ---
function createChessArea(){
  const boardSize = 8;
  const squareSize = 2;
  for(let i=0;i<boardSize;i++){
    for(let j=0;j<boardSize;j++){
      const color = (i+j)%2===0?0xffffff:0x000000;
      const square = new THREE.Mesh(
        new THREE.BoxGeometry(squareSize,0.2,squareSize),
        new THREE.MeshStandardMaterial({color})
      );
      square.position.set(stations.chess.x + i*squareSize,0.1,stations.chess.z + j*squareSize);
      scene.add(square);
    }
  }
}

// --- ROCK STAGE ---
function createRockStage(){
  const stage = new THREE.Mesh(
    new THREE.BoxGeometry(12,1,8),
    new THREE.MeshStandardMaterial({color:0x333333})
  );
  stage.position.set(stations.rock.x,0.5,stations.rock.z);
  scene.add(stage);

  // instruments (emoji planes)
  const drum = makeEmojiSprite("ü•Å",3);
  drum.position.set(stations.rock.x+2,1.5,stations.rock.z);
  scene.add(drum);
  const guitar = makeEmojiSprite("üé∏",3);
  guitar.position.set(stations.rock.x-2,1.5,stations.rock.z);
  scene.add(guitar);
}

// --- EMOJI SPRITE ---
function makeEmojiSprite(emoji,size){
  const canvas = document.createElement('canvas');
  canvas.width=256; canvas.height=256;
  const ctx=canvas.getContext('2d');
  ctx.font="200px Arial";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText(emoji,128,128);
  const tex=new THREE.CanvasTexture(canvas);
  const mat=new THREE.SpriteMaterial({map:tex});
  const sprite=new THREE.Sprite(mat);
  sprite.scale.set(size,size,size);
  return sprite;
}

// --- BACK TO HUB ---
function backHub(){
  currentStation = null;
  vehicleGroup.position.set(hubPos.x,0,hubPos.z);
  document.getElementById("gameText").innerText="üèôÔ∏è Back to Hub";
}

// --- CHECK STATIONS ---
function checkStations(){
  if(currentStation) return;
  for(const [name,s] of Object.entries(stations)){
    const dx = vehicleGroup.position.x - s.x;
    const dz = vehicleGroup.position.z - s.z;
    const distance = Math.sqrt(dx*dx + dz*dz);
    if(distance < s.radius){
      currentStation=name;
      document.getElementById("gameText").innerText = name==="chess"?"‚ôî‚ôö Chess Area":"üé∏ Rock Stage";
    }
  }
}

// --- ANIMATE ---
function animate(){
  requestAnimationFrame(animate);
  const delta = clock.getDelta();

  vehicleGroup.rotation.y += turn;
  vehicleGroup.position.x += Math.sin(vehicleGroup.rotation.y)*speed;
  vehicleGroup.position.z += Math.cos(vehicleGroup.rotation.y)*speed;

  // Camera follow
  camera.position.lerp(
    new THREE.Vector3(
      vehicleGroup.position.x + Math.sin(vehicleGroup.rotation.y)*15,
      6,
      vehicleGroup.position.z + Math.cos(vehicleGroup.rotation.y)*15
    ), 0.1
  );
  camera.lookAt(vehicleGroup.position);

  checkStations();

  renderer.render(scene,camera);
}

</script>
</body>
</html>
