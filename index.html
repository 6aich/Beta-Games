<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸš˜ Beta Games 3D Hub</title>
<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }
#ui { position:absolute; top:10px; left:10px; color:white; z-index:10;
     background:rgba(0,0,0,0.6); padding:10px; border-radius:10px; }
button { font-size:16px; margin:2px; cursor:pointer; }
#gameText { position:absolute; bottom:10px; left:10px; color:white; font-size:20px; z-index:10; }
</style>
</head>
<body>

<div id="ui">
<select id="vehicleSelect">
<option value="car">ğŸš— Car</option>
<option value="plane">âœˆï¸ Plane</option>
<option value="rocket">ğŸš€ Rocket</option>
</select>
<button onclick="switchVehicle()">Switch Vehicle</button>
<button onclick="goMaze()">ğŸ§© Maze</button>
<button onclick="goBoard()">â™Ÿï¸ Board Games</button>
<button onclick="goStage()">ğŸ¸ Rock Stage</button>
<button onclick="backHub()">ğŸ™ï¸ Back to Hub</button>
<br><br>
Controls: WASD / Arrow Keys
</div>
<div id="gameText"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.157/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157/examples/js/controls/PointerLockControls.js"></script>

<script>

// --- CORE THREE.JS SETUP ---
let scene, camera, renderer;
let vehicle, vehicleType="car", speed=0, turn=0;
let policeCars=[], policeActive=false, chaseTimer=0;
let clock=new THREE.Clock();
let objects = [];

init();
animate();

// --- INIT FUNCTION ---
function init(){
 scene = new THREE.Scene();
 scene.background = new THREE.Color(0x87ceeb);

 camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
 camera.position.set(0,6,10);

 renderer = new THREE.WebGLRenderer({antialias:true});
 renderer.setSize(window.innerWidth,window.innerHeight);
 document.body.appendChild(renderer.domElement);

 // Lights
 scene.add(new THREE.AmbientLight(0xffffff,0.5));
 const sun = new THREE.DirectionalLight(0xffffff,1);
 sun.position.set(10,20,10);
 scene.add(sun);

 // Ground
 const ground = new THREE.Mesh(
   new THREE.PlaneGeometry(500,500),
   new THREE.MeshStandardMaterial({color:0x444444})
 );
 ground.rotation.x = -Math.PI/2;
 scene.add(ground);

 createCity();
 createVehicle("car");
 spawnPolice();

 // Keyboard controls
 document.addEventListener("keydown", e=>{switch(e.code){
   case "ArrowUp": case "KeyW": speed=0.5; break;
   case "ArrowDown": case "KeyS": speed=-0.3; break;
   case "ArrowLeft": case "KeyA": turn=0.05; break;
   case "ArrowRight": case "KeyD": turn=-0.05; break;
 }});
 document.addEventListener("keyup",()=>{speed=0;turn=0;});

 window.addEventListener("resize", ()=>{
   camera.aspect=window.innerWidth/window.innerHeight;
   camera.updateProjectionMatrix();
   renderer.setSize(window.innerWidth,window.innerHeight);
 });
}

// --- CREATE CITY ---
function createCity(){
 for(let i=0;i<40;i++){
   const h = Math.random()*20+5;
   const building = new THREE.Mesh(
     new THREE.BoxGeometry(5,h,5),
     new THREE.MeshStandardMaterial({color:0x666666})
   );
   building.position.set((Math.random()-0.5)*200,h/2,(Math.random()-0.5)*200);
   scene.add(building);
   objects.push(building);
 }
}

// --- VEHICLE CREATION ---
function createVehicle(type){
 if(vehicle) scene.remove(vehicle);
 let geo = new THREE.BoxGeometry(2,1,4);
 let mat = new THREE.MeshStandardMaterial({color:0xff0000});
 if(type=="plane") geo = new THREE.BoxGeometry(3,1,6);
 if(type=="rocket") geo = new THREE.CylinderGeometry(0.5,0.5,6,32);
 vehicle = new THREE.Mesh(geo,mat);
 vehicle.position.y=0.5;
 scene.add(vehicle);
 vehicleType = type;
}

// --- VEHICLE SWITCH ---
function switchVehicle(){
 const select=document.getElementById("vehicleSelect");
 createVehicle(select.value);
}

// --- POLICE SPAWN & CHASE ---
function spawnPolice(){
 policeCars=[]; let count=Math.floor(Math.random()*4)+1;
 for(let i=0;i<count;i++){
   const p = new THREE.Mesh(
     new THREE.BoxGeometry(2,1,4),
     new THREE.MeshStandardMaterial({color:0x0000ff})
   );
   p.position.set((Math.random()-0.5)*80,0.5,(Math.random()-0.5)*80);
   scene.add(p);
   policeCars.push(p);
 }
 chaseTimer=0; policeActive=true;
}

// --- ANIMATE ---
function animate(){
 requestAnimationFrame(animate);
 let delta = clock.getDelta();

 vehicle.rotation.y += turn;
 vehicle.translateZ(speed);

 // Camera follow
 camera.position.lerp(
   new THREE.Vector3(
     vehicle.position.x+Math.sin(vehicle.rotation.y)*10,
     6,
     vehicle.position.z+Math.cos(vehicle.rotation.y)*10
   ),0.1
 );
 camera.lookAt(vehicle.position);

 updatePolice();
 renderer.render(scene,camera);
}

// --- UPDATE POLICE ---
function updatePolice(){
 if(!policeActive) return;
 chaseTimer += 0.016;
 policeCars.forEach(p=>{
   const dir=new THREE.Vector3().subVectors(vehicle.position,p.position).normalize();
   p.position.add(dir.multiplyScalar(0.15));
   p.lookAt(vehicle.position);
   if(p.position.distanceTo(vehicle.position)<2){
     alert("ğŸš“ You got caught! Restarting...");
     location.reload();
   }
 });
 if(chaseTimer>30){
   policeCars.forEach(p=>scene.remove(p));
   policeCars=[];
   policeActive=false;
   setTimeout(spawnPolice,5000);
 }
}

// --- HUB STATIONS ---
function goMaze(){document.getElementById("gameText").innerText="ğŸ§© Entering Maze... (placeholder)";}
function goBoard(){document.getElementById("gameText").innerText="â™Ÿï¸ Entering Board Games... (placeholder)";}
function goStage(){document.getElementById("gameText").innerText="ğŸ¸ Entering Rock Stage... AI drums/piano sing now!";}
function backHub(){document.getElementById("gameText").innerText="ğŸ™ï¸ Back to Hub";}

</script>
</body>
</html>
